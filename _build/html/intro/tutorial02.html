

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>编写你的第一个Django应用，第2部分 &mdash; Django 1.10.dev20160423182652 文档</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Django 1.10.dev20160423182652 文档" href="../index.html"/>
        <link rel="up" title="开始" href="index.html"/>
        <link rel="next" title="编写你的第一个Django应用，第3部分" href="tutorial03.html"/>
        <link rel="prev" title="编写你的第一个Django应用，第1部分" href="tutorial01.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../contents.html" class="icon icon-home"> Django
          

          
          </a>

          
            
            
              <div class="version">
                1.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Django 最新中文文档</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">开始</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">初识 Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html">快速安装指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial01.html">编写你的第一个Django应用，第1部分</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">编写你的第一个Django应用，第2部分</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#database-setup">数据库配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-models">创建模型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#activating-models">使用模型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#playing-with-the-api">初试 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#introducing-the-django-admin">介绍 Django 管理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-an-admin-user">输入你想使用的用户名，然后回车。</a></li>
<li class="toctree-l4"><a class="reference internal" href="#start-the-development-server">启动用于开发的服务器</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enter-the-admin-site">进入管理站点页面</a></li>
<li class="toctree-l4"><a class="reference internal" href="#make-the-poll-app-modifiable-in-the-admin">向管理页面中加入投票应用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#explore-the-free-admin-functionality">体验便捷的管理功能</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial03.html">编写你的第一个Django应用，第3部分</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial04.html">编写你的第一个Django应用，第4部分</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial05.html">编写你的第一个Django应用，第5部分</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial06.html">编写你的第一个Django应用，第7部分</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial07.html">编写你的第一个Django应用，第7部分</a></li>
<li class="toctree-l2"><a class="reference internal" href="reusable-apps.html">Advanced tutorial: How to write reusable apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnext.html">What to read next</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">编写你的第一个Django补丁</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../topics/index.html">Using Django</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">&#8220;How-to&#8221; guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">Django FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/index.html">元文件和杂记</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internals/index.html">Django internals</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../contents.html">Django</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../contents.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">开始</a> &raquo;</li>
      
    <li>编写你的第一个Django应用，第2部分</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/intro/tutorial02.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="s-writing-your-first-django-app-part-2">
<span id="writing-your-first-django-app-part-2"></span><h1>编写你的第一个Django应用，第2部分<a class="headerlink" href="#writing-your-first-django-app-part-2" title="永久链接至标题">¶</a></h1>
<p>这部分教程从 <a class="reference internal" href="tutorial01.html"><em>第1部分</em></a>  结尾的地方继续讲起. 我们将建立数据库, 创建您的第一个模型,并主要关注 Django 提供的自动生成的管理页面</p>
<div class="section" id="s-database-setup">
<span id="database-setup"></span><h2>数据库配置<a class="headerlink" href="#database-setup" title="永久链接至标题">¶</a></h2>
<p>现在，打开 <code class="file docutils literal"><span class="pre">mysite/settings.py</span></code> 。这是包含着 Django 项目设置的 Python 模块。</p>
<p>通常，这个配置文件将会使用 SQLite 作为默认数据库。如果你不熟悉数据库，或者只是想尝试一下 Django，使用 SQLite 会是最简单的选择。 Python 已经内置了 SQLite 支持，所以你不需要安装任何其他东西就可以使用它。当你开始第一个真正的项目时，你可能倾向于从一开始就使用更强大的数据库，比如 PostgreSQL，来避免中途切换数据库这个令人头痛的问题。</p>
<p>如果你想使用其他数据库，你需要安装合适的 <a class="reference internal" href="../topics/install.html#database-installation"><span>database bindings</span></a> ，然后改变设置文件中 <a class="reference internal" href="../ref/settings.html#std:setting-DATABASES"><code class="xref std std-setting docutils literal"><span class="pre">DATABASES</span></code></a> <code class="docutils literal"><span class="pre">'default'</span></code>  项目中的一些键值：</p>
<ul class="simple">
<li><p class="first"><a class="reference internal" href="../ref/settings.html#std:setting-DATABASE-ENGINE"><code class="xref std std-setting docutils literal"><span class="pre">ENGINE</span></code></a> &#8211; 可选值有 <code class="docutils literal"><span class="pre">'django.db.backends.sqlite3'</span></code>, <code class="docutils literal"><span class="pre">'django.db.backends.postgresql'</span></code>, <code class="docutils literal"><span class="pre">'django.db.backends.mysql'</span></code>, 或 <code class="docutils literal"><span class="pre">'django.db.backends.oracle'</span></code>. 其它 <a class="reference internal" href="../ref/databases.html#third-party-notes"><span>可用后端</span></a> .</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/settings.html#std:setting-NAME"><code class="xref std std-setting docutils literal"><span class="pre">NAME</span></code></a>  - 数据库的名称。如果使用的是 SQLite，数据库将是你电脑上的一个文件，在这种情况下， <a class="reference internal" href="../ref/settings.html#std:setting-NAME"><code class="xref std std-setting docutils literal"><span class="pre">NAME</span></code></a>  应该是此文件的绝对路径，包括文件名。默认值 <code class="docutils literal"><span class="pre">os.path.join(BASE_DIR,</span> <span class="pre">'db.sqlite3')</span></code> 将会把数据库文件储存在项目的根目录。</p>
</li>
</ul>
<p>如果你不是使用 SQLite，则必须添加一些额外设置，比如 <a class="reference internal" href="../ref/settings.html#std:setting-USER"><code class="xref std std-setting docutils literal"><span class="pre">USER</span></code></a> 、 <a class="reference internal" href="../ref/settings.html#std:setting-PASSWORD"><code class="xref std std-setting docutils literal"><span class="pre">PASSWORD</span></code></a> 、  <a class="reference internal" href="../ref/settings.html#std:setting-HOST"><code class="xref std std-setting docutils literal"><span class="pre">HOST</span></code></a>  等等。想了解更多数据库设置方面的内容，请看文档：<a class="reference internal" href="../ref/settings.html#std:setting-DATABASES"><code class="xref std std-setting docutils literal"><span class="pre">DATABASES</span></code></a> 。</p>
<div class="admonition-for-databases-other-than-sqlite admonition">
<p class="first admonition-title">SQLite 以外的其它数据库</p>
<p>如果你使用了SQLite以外的数据库，请确认在使用前已经创建了数据库。你可以通过在你的数据库交互式命令行中使用 &#8220;<code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">DATABASE</span> <span class="pre">database_name;</span></code>&#8221;  命令来完成这件事。</p>
<p>另外，还要确保该数据库用户中提供  <code class="file docutils literal"><span class="pre">mysite/settings.py</span></code> 具有 &#8220;create database&#8221;  权限。这使得自动创建的  <a class="reference internal" href="../topics/testing/overview.html#the-test-database"><span>test database</span></a>  将在以后的教程需要。</p>
<p class="last">如果你使用 SQLite，那么你不需要在使用前做任何事 - 数据库会在需要的时候自动创建。</p>
</div>
<p>当编辑 <code class="file docutils literal"><span class="pre">mysite/settings.py</span></code> 文件时,先设置 <a class="reference internal" href="../ref/settings.html#std:setting-TIME_ZONE"><code class="xref std std-setting docutils literal"><span class="pre">TIME_ZONE</span></code></a> to 为你自己时区.</p>
<p>此外，关注一下文件头部的 <a class="reference internal" href="../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a>  设置项，这里包括了会在你项目中启用的所有 Django 应用。应用能在多个项目中使用，你也可以打包并且发布应用，让别人使用它们。</p>
<p>通常， <a class="reference internal" href="../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a>  默认包括了以下 Django 的自带应用：</p>
<ul class="simple">
<li><p class="first"><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal"><span class="pre">django.contrib.admin</span></code></a> &#8211;  管理员站点， 你很快就会使用它。</p>
</li>
<li><p class="first"><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal"><span class="pre">django.contrib.auth</span></code></a> &#8211; 验证系统。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/contrib/contenttypes.html#module-django.contrib.contenttypes" title="django.contrib.contenttypes: Provides generic interface to installed models."><code class="xref py py-mod docutils literal"><span class="pre">django.contrib.contenttypes</span></code></a> &#8211; 内容类型框架.</p>
</li>
<li><p class="first"><a class="reference internal" href="../topics/http/sessions.html#module-django.contrib.sessions" title="django.contrib.sessions: Provides session management for Django projects."><code class="xref py py-mod docutils literal"><span class="pre">django.contrib.sessions</span></code></a> &#8211; 会话框架.</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/contrib/messages.html#module-django.contrib.messages" title="django.contrib.messages: Provides cookie- and session-based temporary message storage."><code class="xref py py-mod docutils literal"><span class="pre">django.contrib.messages</span></code></a> &#8211; 消息框架.</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/contrib/staticfiles.html#module-django.contrib.staticfiles" title="django.contrib.staticfiles: An app for handling static files."><code class="xref py py-mod docutils literal"><span class="pre">django.contrib.staticfiles</span></code></a> &#8211; 管理静态文件的框架.</p>
</li>
</ul>
<p>这些应用被默认启用是为了给常规项目提供方便。</p>
<p>默认开启的某些应用需要至少一个数据表，所以，在使用他们之前需要在数据库中创建一些表。请执行以下命令：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py migrate
</pre></div>
</div>
<p>这个 <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal"><span class="pre">migrate</span></code></a>  命令检查 <a class="reference internal" href="../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a> 设置，为其中的每个应用创建需要的数据表，至于具体会创建什么，这取决于你的 <code class="file docutils literal"><span class="pre">mysite/settings.py</span></code> 设置文件和每个应用的数据库迁移文件(我们稍后会介绍这个)。这个命令所执行的每个迁移操作都会在终端中显示出来。如果你感兴趣的话，运行你数据库的命令行工具，并输入 <code class="docutils literal"><span class="pre">\dt</span></code>  (PostgreSQL)， <code class="docutils literal"><span class="pre">SHOW</span> <span class="pre">TABLES;</span></code> (MySQL)， <code class="docutils literal"><span class="pre">.schema</span></code> (SQLite)或者 <code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">TABLE_NAME</span> <span class="pre">FROM</span> <span class="pre">USER_TABLES;</span></code> (Oracle) 来看看 Django 到底创建了哪些表。</p>
<div class="admonition-for-the-minimalists admonition">
<p class="first admonition-title">写给极简主义者</p>
<p class="last">就像之前说的，为了方便大多数项目，我们默认激活了一些应用，但并不是每个人都需要它们。如果你不需要某个或某些应用(s)，你可以在运行 <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal"><span class="pre">migrate</span></code></a>  前毫无顾虑的从 <a class="reference internal" href="../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a>  里注释或者删除掉它们。 <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal"><span class="pre">migrate</span></code></a> 命令只会为在 <a class="reference internal" href="../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a>  里声明了的应用进行数据库迁移。</p>
</div>
</div>
<div class="section" id="s-creating-models">
<span id="s-id1"></span><span id="creating-models"></span><span id="id1"></span><h2>创建模型<a class="headerlink" href="#creating-models" title="永久链接至标题">¶</a></h2>
<p>在 Django 里写一个数据库驱动的 Web 应用的第一步是定义模型 - 也就是数据库结构设计和附加的其他元数据。</p>
<div class="admonition-philosophy admonition">
<p class="first admonition-title">设计哲学</p>
<p>模型是真实数据的简单明确的描述。它包含了储存的数据所必要的字段和行为。Django 遵循 <a class="reference internal" href="../misc/design-philosophies.html#dry"><span>DRY Principle</span></a> 。它的目标是你只需要定义数据模型，然后其他的杂七杂八代码你都不用关心，它们会自动从模型生成。</p>
<p class="last">来介绍一下迁移 - 举个例子，不像 Ruby On Rails，Django 的迁移代码是由你的模型文件自动生成的，它本质上只是个历史记录，Django 可以用它来进行数据库的滚动更新，通过这种方式使其能够和当前的模型匹配。</p>
</div>
<p>在这个简单的投票应用中，需要创建两个模型：问题``Question``和选项``Choice``。问题模型包括问题描述和发布时间。选项模型有两个字段，选项描述和当前得票数。每个选项属于一个问题。</p>
<p>这些概念可以通过一个简单的 Python 类来描述。按照下面的例子来编辑 <code class="file docutils literal"><span class="pre">polls/models.py</span></code> 文件：</p>
<div class="highlight-python"><div class="snippet-filename">polls/models.py</div>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Question</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">question_text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="s1">&#39;date published&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Choice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">choice_text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">votes</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>代码非常直白。每个模型被表示为 <a class="reference internal" href="../ref/models/instances.html#django.db.models.Model" title="django.db.models.Model"><code class="xref py py-class docutils literal"><span class="pre">django.db.models.Model</span></code></a> 类的子类。每个模型有一些类变量，它们都表示模型里的一个数据库字段。</p>
<p>每个字段都是 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field" title="django.db.models.Field"><code class="xref py py-class docutils literal"><span class="pre">Field</span></code></a> 类的实例 - 比如，字符字段被表示为 <a class="reference internal" href="../ref/models/fields.html#django.db.models.CharField" title="django.db.models.CharField"><code class="xref py py-class docutils literal"><span class="pre">CharField</span></code></a> ，日期时间字段被表示为 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal"><span class="pre">DateTimeField</span></code></a> 。这将告诉 Django 每个字段要处理的数据类型。</p>
<p>每个 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field" title="django.db.models.Field"><code class="xref py py-class docutils literal"><span class="pre">Field</span></code></a> 类实例变量的名字(例如 <code class="docutils literal"><span class="pre">question_text</span></code> 或 <code class="docutils literal"><span class="pre">pub_date</span></code> )也是字段名，所以最好使用对机器友好的格式。你将会在 Python 代码里使用它们，而数据库会将它们作为列名。</p>
<p>你可以使用可选的选项来为 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field" title="django.db.models.Field"><code class="xref py py-class docutils literal"><span class="pre">Field</span></code></a>  定义一个人类可读的名字。这个功能在很多 Django 内部组成部分中都被使用了，而且作为文档的一部分。如果某个字段没有提供此名称，Django 将会使用对机器友好的名称,也就是变量名。在上面的例子中，我们只为  <code class="docutils literal"><span class="pre">Question.pub_date</span></code> 定义了对人类友好的名字。对于模型内的其他字段，他们的机器友好名也会被作为人类友好名使用。</p>
<p>定义某些 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field" title="django.db.models.Field"><code class="xref py py-class docutils literal"><span class="pre">Field</span></code></a>  类实例需要参数。例如 <a class="reference internal" href="../ref/models/fields.html#django.db.models.CharField" title="django.db.models.CharField"><code class="xref py py-class docutils literal"><span class="pre">CharField</span></code></a>  需要一个 <a class="reference internal" href="../ref/models/fields.html#django.db.models.CharField.max_length" title="django.db.models.CharField.max_length"><code class="xref py py-attr docutils literal"><span class="pre">max_length</span></code></a>  参数。这个参数的用处不止于用来定义数据库结构，也用于验证数据，我们稍后将会看到这方面的内容。</p>
<p>A <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field" title="django.db.models.Field"><code class="xref py py-class docutils literal"><span class="pre">Field</span></code></a> can also have various optional arguments; in
this case, we&#8217;ve set the <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.default" title="django.db.models.Field.default"><code class="xref py py-attr docutils literal"><span class="pre">default</span></code></a> value of
<code class="docutils literal"><span class="pre">votes</span></code> to 0.</p>
<p>注意在最后，我们使用 <a class="reference internal" href="../ref/models/fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><code class="xref py py-class docutils literal"><span class="pre">ForeignKey</span></code></a> 。定义了一个关系。这将告诉 Django，每个 <code class="docutils literal"><span class="pre">Choice</span></code> 对象都关联到一个  <code class="docutils literal"><span class="pre">Question</span></code>  对象。Django 支持所有常用的数据库关系：多对一、多对多和一对一。</p>
</div>
<div class="section" id="s-activating-models">
<span id="activating-models"></span><h2>使用模型<a class="headerlink" href="#activating-models" title="永久链接至标题">¶</a></h2>
<p>上面的一小段用于创建模型的代码给了 Django 很多信息，通过这些信息，Django 可以：</p>
<ul class="simple">
<li><p class="first">为这个应用创建数据库结构(生成 <code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> 语句)。</p>
</li>
<li><p class="first">创建可以与 <code class="docutils literal"><span class="pre">Question</span></code> 和 <code class="docutils literal"><span class="pre">Choice</span></code> 对象进行交互的 Python 数据库 API。</p>
</li>
</ul>
<p>但是首先得把 <code class="docutils literal"><span class="pre">polls</span></code> 应用安装到我们的项目里。</p>
<div class="admonition-philosophy admonition">
<p class="first admonition-title">设计哲学</p>
<p class="last">Django 应用是&#8221;可插拔&#8221;的。你可以在多个项目中使用同一个应用。除此之外，你还可以发布自己的应用，因为它们并不会被绑定到当前安装的 Django 上。</p>
</div>
<p>再次编辑  <code class="file docutils literal"><span class="pre">mysite/settings.py</span></code> ，改变  <a class="reference internal" href="../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a>   设置，使其包含字符串 <code class="docutils literal"><span class="pre">'polls.apps.PollsConfig'</span></code> 。它现在看起来应该像这样：</p>
<div class="highlight-python"><div class="snippet-filename">mysite/settings.py</div>
<div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;polls.apps.PollsConfig&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>现在你的 Django 项目会包含 <code class="docutils literal"><span class="pre">polls</span></code>  应用。接着运行下面的命令</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py makemigrations polls
</pre></div>
</div>
<p>你将会看到类似于下面这样的输出：</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Migrations for &#39;polls&#39;:
  polls/migrations/0001_initial.py:
    - Create model Choice
    - Create model Question
    - Add field question to choice
</pre></div>
</div>
<p>通过 <code class="docutils literal"><span class="pre">makemigrations</span></code> 命令，Django 会检测你对模型文件的修改(在这种情况下，你已经取得了新的)，并且把修改的部分储存为一次 <em>迁移</em>。</p>
<p>迁移是 Django 对于模型定义(也就是你的数据库结构)的变化的储存形式 - 没那么玄乎，它们其实也只是一些你磁盘上的文件。如果你想的话，你可以阅读一下你模型的迁移数据，它被储存在 <code class="docutils literal"><span class="pre">polls/migrations/0001_initial.py</span></code> 里。别担心，你不需要每次都阅读迁移文件，但是它们被设计成人类可读的形式，这是为了便于你手动修改它们。</p>
<p>Django 有一个自动执行数据库迁移并同步管理你的数据库结构的命令 - 这个命令是 <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal"><span class="pre">migrate</span></code></a> ，我们马上就会接触它 - 但是首先，让我们看看迁移命令会执行哪些 SQL 语句。<a class="reference internal" href="../ref/django-admin.html#django-admin-sqlmigrate"><code class="xref std std-djadmin docutils literal"><span class="pre">sqlmigrate</span></code></a>   命令接收一个迁移的名称，然后返回给你对应的 SQL：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py sqlmigrate polls 0001
</pre></div>
</div>
<p>你将会看到类似下面这样的输出(我把输出重组成了人类可读的格式)：</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">BEGIN</span><span class="p">;</span>
<span class="c1">--</span>
<span class="c1">-- Create model Choice</span>
<span class="c1">--</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;polls_choice&quot;</span> <span class="p">(</span>
    <span class="ss">&quot;id&quot;</span> <span class="nb">serial</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="ss">&quot;choice_text&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;votes&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
<span class="c1">--</span>
<span class="c1">-- Create model Question</span>
<span class="c1">--</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;polls_question&quot;</span> <span class="p">(</span>
    <span class="ss">&quot;id&quot;</span> <span class="nb">serial</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="ss">&quot;question_text&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;pub_date&quot;</span> <span class="k">timestamp</span> <span class="k">with</span> <span class="n">time</span> <span class="k">zone</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
<span class="c1">--</span>
<span class="c1">-- Add field question to choice</span>
<span class="c1">--</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="ss">&quot;polls_choice&quot;</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="ss">&quot;question_id&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="ss">&quot;polls_choice&quot;</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="ss">&quot;question_id&quot;</span> <span class="k">DROP</span> <span class="k">DEFAULT</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="ss">&quot;polls_choice_7aa0f6ee&quot;</span> <span class="k">ON</span> <span class="ss">&quot;polls_choice&quot;</span> <span class="p">(</span><span class="ss">&quot;question_id&quot;</span><span class="p">);</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="ss">&quot;polls_choice&quot;</span>
  <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="ss">&quot;polls_choice_question_id_246c99a640fbbd72_fk_polls_question_id&quot;</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="ss">&quot;question_id&quot;</span><span class="p">)</span>
    <span class="k">REFERENCES</span> <span class="ss">&quot;polls_question&quot;</span> <span class="p">(</span><span class="ss">&quot;id&quot;</span><span class="p">)</span>
    <span class="k">DEFERRABLE</span> <span class="k">INITIALLY</span> <span class="k">DEFERRED</span><span class="p">;</span>

<span class="k">COMMIT</span><span class="p">;</span>
</pre></div>
</div>
<p>请注意以下几点：</p>
<ul class="simple">
<li><p class="first">输出的内容和你使用的数据库有关，上面的输出示例使用的是 PostgreSQL。</p>
</li>
<li><p class="first">数据库的表名是由应用名( <code class="docutils literal"><span class="pre">polls</span></code>)和模型名的小写形式( <code class="docutils literal"><span class="pre">question</span></code> 和  <code class="docutils literal"><span class="pre">choice</span></code> .)连接而来。（如果需要，你可以自定义此行为。）</p>
</li>
<li><p class="first">主键(IDs)会被自动创建。(当然，你也可以自定义。)</p>
</li>
<li><p class="first">默认的，Django 会在外键字段名后追加字符串 <code class="docutils literal"><span class="pre">&quot;_id&quot;</span></code> 。(同样，这也可以自定义。)</p>
</li>
<li><p class="first">外键关系由 <code class="docutils literal"><span class="pre">FOREIGN</span> <span class="pre">KEY</span></code> 生成。你不用关心 <code class="docutils literal"><span class="pre">DEFERRABLE</span></code>  部分，它只是告诉 PostgreSQL，请在事务全都执行完之后再创建外键关系。</p>
</li>
<li><p class="first">生成的 SQL 语句是为你所用的数据库定制的，所以那些和数据库有关的字段类型，比如 <code class="docutils literal"><span class="pre">auto_increment</span></code> (MySQL)、 <code class="docutils literal"><span class="pre">serial</span></code> (PostgreSQL)和  <code class="docutils literal"><span class="pre">integer</span> <span class="pre">primary</span> <span class="pre">key</span> <span class="pre">autoincrement</span></code> (SQLite)，Django 会帮你自动处理。那些和引号相关的事情 - 例如，是使用单引号还是双引号 - 也一样会被自动处理。</p>
</li>
<li><p class="first">这个 <a class="reference internal" href="../ref/django-admin.html#django-admin-sqlmigrate"><code class="xref std std-djadmin docutils literal"><span class="pre">sqlmigrate</span></code></a> 命令并没有真正在你的数据库中的执行迁移 - 它只是把命令输出到屏幕上，让你看看 Django 认为需要执行哪些 SQL 语句。这在你想看看 Django 到底准备做什么，或者当你是数据库管理员，需要写脚本来批量处理数据库时会很有用。</p>
</li>
</ul>
<p>如果你感兴趣，你也可以试试运行 <a class="reference internal" href="../ref/django-admin.html#django-admin-check"><code class="xref std std-djadmin docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">check</span></code></a> ;这个命令帮助你检查项目中的问题，并且在检查过程中不会对数据库进行任何操作。</p>
<p>现在，再次运行 <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal"><span class="pre">migrate</span></code></a> 命令，在数据库里创建新定义的模型的数据表：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py migrate
<span class="go">Operations to perform:</span>
<span class="go">  Apply all migrations: admin, auth, contenttypes, polls, sessions</span>
<span class="go">Running migrations:</span>
<span class="go">  Rendering model states... DONE</span>
<span class="go">  Applying polls.0001_initial... OK</span>
</pre></div>
</div>
<p>这个 <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal"><span class="pre">migrate</span></code></a> 命令选中所有还没有执行过的迁移(Django 通过在数据库中创建一个特殊的表 <code class="docutils literal"><span class="pre">django_migrations</span></code> 来跟踪执行过哪些迁移)并应用在数据库上 - 也就是将你对模型的更改同步到数据库结构上。</p>
<p>迁移是非常强大的功能，它能让你在开发过程中持续的改变数据库结构而不需要重新删除和创建表 - 它专注于使数据库平滑升级而不会丢失数据。我们会在后面的教程中更加深入的学习这部分内容，现在，你只需要记住，改变模型需要这三步：</p>
<ul class="simple">
<li><p class="first">编辑 <code class="docutils literal"><span class="pre">models.py</span></code> 文件，改变模型。</p>
</li>
<li><p class="first">运行 <a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><code class="xref std std-djadmin docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span></code></a>   为模型的改变生成迁移文件。</p>
</li>
<li><p class="first">运行  <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code></a>  来应用数据库迁移。</p>
</li>
</ul>
<p>数据库迁移被分解成生成和应用两个命令是为了让你能够在代码控制系统上提交迁移数据并使其能在多个应用里使用；这不仅仅会让开发更加简单，也给别的开发者和生产环境中的使用带来方便。</p>
<p>通过阅读文档 <a class="reference internal" href="../ref/django-admin.html"><em>django-admin documentation</em></a> ，你可以获得关于 <code class="docutils literal"><span class="pre">manage.py</span></code> 工具的更多信息。</p>
</div>
<div class="section" id="s-playing-with-the-api">
<span id="playing-with-the-api"></span><h2>初试 API<a class="headerlink" href="#playing-with-the-api" title="永久链接至标题">¶</a></h2>
<p>现在让我们进入交互式 Python 命令行，尝试一下 Django 为你创建的各种 API。通过以下命令打开 Python 命令行：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py shell
</pre></div>
</div>
<p>我们使用这个命令而不是简单的使用 &#8220;Python&#8221; 是因为 <code class="file docutils literal"><span class="pre">manage.py</span></code> 会设置 <code class="docutils literal"><span class="pre">DJANGO_SETTINGS_MODULE</span></code> 环境变量，这个变量会让 Django 根据 <code class="file docutils literal"><span class="pre">mysite/settings.py</span></code> 文件来设置 Python 包的导入路径。</p>
<div class="admonition-bypassing-manage-py admonition">
<p class="first admonition-title">Bypassing manage.py</p>
<p>如果你不想使用 <code class="file docutils literal"><span class="pre">manage.py</span></code> ，没问题，你只要手动将 <span class="target" id="index-2"></span><a class="reference internal" href="../topics/settings.html#envvar-DJANGO_SETTINGS_MODULE"><code class="xref std std-envvar docutils literal"><span class="pre">DJANGO_SETTINGS_MODULE</span></code></a> 环境变量设置为 <code class="docutils literal"><span class="pre">mysite.settings</span></code> 就行。打开一个普通的 Python 命令行，然后输入以下命令来配置 Django：</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">django</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">django</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</pre></div>
</div>
<p>如果抛出了 <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#AttributeError" title="(在 Python v3.5)"><code class="xref py py-exc docutils literal"><span class="pre">AttributeError</span></code></a> ，那么说明你使用的 Django 版本可能和本教程不匹配。你可以切换到旧版本的教程或者把 Django 升级至最新版本。</p>
<p>你必须在 <code class="file docutils literal"><span class="pre">manage.py</span></code>  所在目录中运行 <code class="docutils literal"><span class="pre">python</span></code>  命令，或者确保这个目录在 Python path 里，因为只有这样 <code class="docutils literal"><span class="pre">import</span> <span class="pre">mysite</span></code>  才能被正确的执行。</p>
<p class="last">阅读文档 <a class="reference internal" href="../ref/django-admin.html"><em>django-admin documentation</em></a> 获取更多信息。</p>
</div>
<p>当你成功进入命令行后，来试试 数据库 <a class="reference internal" href="../topics/db/queries.html"><em>database API</em></a>  吧:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Question</span><span class="p">,</span> <span class="n">Choice</span>   <span class="c1"># Import the model classes we just wrote.</span>

<span class="go"># No questions are in the system yet.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">&lt;QuerySet []&gt;</span>

<span class="go"># Create a new Question.</span>
<span class="go"># Support for time zones is enabled in the default settings file, so</span>
<span class="go"># Django expects a datetime with tzinfo for pub_date. Use timezone.now()</span>
<span class="go"># instead of datetime.datetime.now() and it will do the right thing.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">Question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s2">&quot;What&#39;s new?&quot;</span><span class="p">,</span> <span class="n">pub_date</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>

<span class="go"># Save the object into the database. You have to call save() explicitly.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="go"># Now it has an ID. Note that this might say &quot;1L&quot; instead of &quot;1&quot;, depending</span>
<span class="go"># on which database you&#39;re using. That&#39;s no biggie; it just means your</span>
<span class="go"># database backend prefers to return integers as Python long integer</span>
<span class="go"># objects.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>

<span class="go"># Access model field values via Python attributes.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">question_text</span>
<span class="go">&quot;What&#39;s new?&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">pub_date</span>
<span class="go">datetime.datetime(2012, 2, 26, 13, 0, 0, 775217, tzinfo=&lt;UTC&gt;)</span>

<span class="go"># Change values by changing the attributes, then calling save().</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">question_text</span> <span class="o">=</span> <span class="s2">&quot;What&#39;s up?&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="go"># objects.all() displays all the questions in the database.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">&lt;QuerySet [&lt;Question: Question object&gt;]&gt;</span>
</pre></div>
</div>
<p>等等。用 <code class="docutils literal"><span class="pre">&lt;Question:</span> <span class="pre">Question</span> <span class="pre">object&gt;</span></code>  表示这个对象没什么意思，它无法告诉我们这个对象的详细信息。让我们通过编辑 Question 模型的代码( <code class="docutils literal"><span class="pre">polls/models.py</span></code>  文件)，给 <code class="docutils literal"><span class="pre">Question</span></code>  和 <code class="docutils literal"><span class="pre">Choice</span></code> 增加 <a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.__str__" title="django.db.models.Model.__str__"><code class="xref py py-meth docutils literal"><span class="pre">__str__()</span></code></a>  方法来改善这个问题：</p>
<div class="highlight-python"><div class="snippet-filename">polls/models.py</div>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">python_2_unicode_compatible</span>

<span class="nd">@python_2_unicode_compatible</span>  <span class="c1"># only if you need to support Python 2</span>
<span class="k">class</span> <span class="nc">Question</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">question_text</span>

<span class="nd">@python_2_unicode_compatible</span>  <span class="c1"># only if you need to support Python 2</span>
<span class="k">class</span> <span class="nc">Choice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">choice_text</span>
</pre></div>
</div>
<p>给模型增加 <a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.__str__" title="django.db.models.Model.__str__"><code class="xref py py-meth docutils literal"><span class="pre">__str__()</span></code></a>  方法是很重要的，这不仅仅能给你在命令行里使用带来方便，Django 自动生成的 admin 里也使用这个方法来表示对象。</p>
<p>注意：这些都是常规的 Python方法。让我们添加一个自定义的方法，这只是为了演示：</p>
<div class="highlight-python"><div class="snippet-filename">polls/models.py</div>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>


<span class="k">class</span> <span class="nc">Question</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">def</span> <span class="nf">was_published_recently</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">&gt;=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>新加入的 <code class="docutils literal"><span class="pre">import</span> <span class="pre">datetime</span></code>  和 <code class="docutils literal"><span class="pre">from</span> <span class="pre">django.utils</span> <span class="pre">import</span> <span class="pre">timezone</span></code>  分别导入了 Python 的标准 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#module-datetime" title="(在 Python v3.5)"><code class="xref py py-mod docutils literal"><span class="pre">datetime</span></code></a>  模块和 Django 中和时区相关的 <a class="reference internal" href="../ref/utils.html#module-django.utils.timezone" title="django.utils.timezone: Timezone support."><code class="xref py py-mod docutils literal"><span class="pre">django.utils.timezone</span></code></a> 工具模块。如果你不太熟悉 Python 中的时区处理，看看 <a class="reference internal" href="../topics/i18n/timezones.html"><em>time zone support docs</em></a> 文档吧。</p>
<p>保存文件然后通过 <code class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">shell</span></code>  命令再次打开 Python 交互式命令行：</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Question</span><span class="p">,</span> <span class="n">Choice</span>

<span class="go"># Make sure our __str__() addition worked.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">&lt;QuerySet [&lt;Question: What&#39;s up?&gt;]&gt;</span>

<span class="go"># Django provides a rich database lookup API that&#39;s entirely driven by</span>
<span class="go"># keyword arguments.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;QuerySet [&lt;Question: What&#39;s up?&gt;]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">question_text__startswith</span><span class="o">=</span><span class="s1">&#39;What&#39;</span><span class="p">)</span>
<span class="go">&lt;QuerySet [&lt;Question: What&#39;s up?&gt;]&gt;</span>

<span class="go"># Get the question that was published this year.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">current_year</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="n">current_year</span><span class="p">)</span>
<span class="go">&lt;Question: What&#39;s up?&gt;</span>

<span class="go"># Request an ID that doesn&#39;t exist, this will raise an exception.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">DoesNotExist</span>: <span class="n">Question matching query does not exist.</span>

<span class="go"># Lookup by a primary key is the most common case, so Django provides a</span>
<span class="go"># shortcut for primary-key exact lookups.</span>
<span class="go"># The following is identical to Question.objects.get(id=1).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;Question: What&#39;s up?&gt;</span>

<span class="go"># Make sure our custom method worked.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">was_published_recently</span><span class="p">()</span>
<span class="go">True</span>

<span class="go"># Give the Question a couple of Choices. The create call constructs a new</span>
<span class="go"># Choice object, does the INSERT statement, adds the choice to the set</span>
<span class="go"># of available choices and returns the new Choice object. Django creates</span>
<span class="go"># a set to hold the &quot;other side&quot; of a ForeignKey relation</span>
<span class="go"># (e.g. a question&#39;s choice) which can be accessed via the API.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="go"># Display any choices from the related object set -- none so far.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">&lt;QuerySet []&gt;</span>

<span class="go"># Create three choices.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice_text</span><span class="o">=</span><span class="s1">&#39;Not much&#39;</span><span class="p">,</span> <span class="n">votes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&lt;Choice: Not much&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice_text</span><span class="o">=</span><span class="s1">&#39;The sky&#39;</span><span class="p">,</span> <span class="n">votes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&lt;Choice: The sky&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice_text</span><span class="o">=</span><span class="s1">&#39;Just hacking again&#39;</span><span class="p">,</span> <span class="n">votes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="go"># Choice objects have API access to their related Question objects.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">question</span>
<span class="go">&lt;Question: What&#39;s up?&gt;</span>

<span class="go"># And vice versa: Question objects get access to Choice objects.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">&lt;QuerySet [&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">3</span>

<span class="go"># The API automatically follows relationships as far as you need.</span>
<span class="go"># Use double underscores to separate relationships.</span>
<span class="go"># This works as many levels deep as you want; there&#39;s no limit.</span>
<span class="go"># Find all Choices for any question whose pub_date is in this year</span>
<span class="go"># (reusing the &#39;current_year&#39; variable we created above).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Choice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">question__pub_date__year</span><span class="o">=</span><span class="n">current_year</span><span class="p">)</span>
<span class="go">&lt;QuerySet [&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]&gt;</span>

<span class="go"># Let&#39;s delete one of the choices. Use delete() for that.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">choice_text__startswith</span><span class="o">=</span><span class="s1">&#39;Just hacking&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p>阅读  <a class="reference internal" href="../ref/models/relations.html"><em>Accessing related objects</em></a>  文档可以获取关于数据库关系的更多内容。想知道关于双下划线的更多用法，参见 <a class="reference internal" href="../topics/db/queries.html#field-lookups-intro"><span>Field lookups</span></a> 文档。数据库 API 的所有细节可以在 <a class="reference internal" href="../topics/db/queries.html"><em>Database API reference</em></a> 文档中找到。</p>
</div>
<div class="section" id="s-introducing-the-django-admin">
<span id="introducing-the-django-admin"></span><h2>介绍 Django 管理<a class="headerlink" href="#introducing-the-django-admin" title="永久链接至标题">¶</a></h2>
<div class="admonition-philosophy admonition">
<p class="first admonition-title">设计哲学</p>
<p>Generating admin sites for your staff or clients to add, change, and delete
content is tedious work that doesn&#8217;t require much creativity. For that
reason, Django entirely automates creation of admin interfaces for models.</p>
<p>Django 产生于一个公众页面和内容发布者页面完全分离的新闻类站点的开发过程中。站点管理人员使用管理系统来添加新闻、事件和体育时讯等，这些添加的内容被显示在公众页面上。Django 通过为站点管理人员创建统一的内容编辑界面解决了这个问题。</p>
<p class="last">管理界面不是为了网站的访问者，而是为管理者准备的。</p>
</div>
<div class="section" id="s-creating-an-admin-user">
<span id="creating-an-admin-user"></span><h3>输入你想使用的用户名，然后回车。<a class="headerlink" href="#creating-an-admin-user" title="永久链接至标题">¶</a></h3>
<p>首先，我们得创建一个能登录管理页面的用户。请运行下面的命令：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py createsuperuser
</pre></div>
</div>
<p>键入你想要使用的用户名，然后按下回车键：</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Username: admin
</pre></div>
</div>
<p>然后提示你输入想要使用的邮件地址：</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Email address: admin@example.com
</pre></div>
</div>
<p>最后一步是输入密码。你会被要求输入两次密码，第二次的目的是为了确认第一次输入的确实是你想要的密码。</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Password: **********
Password (again): *********
Superuser created successfully.
</pre></div>
</div>
</div>
<div class="section" id="s-start-the-development-server">
<span id="start-the-development-server"></span><h3>启动用于开发的服务器<a class="headerlink" href="#start-the-development-server" title="永久链接至标题">¶</a></h3>
<p>Django 的管理界面默认就是启用的。让我们启动开发服务器，看看它到底是什么样的。</p>
<p>如果服务没有启动它就像这样：</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py runserver
</pre></div>
</div>
<p>现在，打开浏览器，转到你本地域名的 &#8220;/admin/&#8221; 目录， &#8211; 比如 &#8220;<a class="reference external" href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a>&#8221;  。你应该会看见管理员登录界面：</p>
<img alt="Django admin login screen" src="../_images/admin01.png" />
<p>因为 <a class="reference internal" href="../topics/i18n/translation.html"><em>翻译</em></a>  功能默认是开着的，所以登录界面可能会使用你的语言，取决于你的浏览器设置和是否 Django 已被翻译成你的语言。</p>
</div>
<div class="section" id="s-enter-the-admin-site">
<span id="enter-the-admin-site"></span><h3>进入管理站点页面<a class="headerlink" href="#enter-the-admin-site" title="永久链接至标题">¶</a></h3>
<p>现在，试着使用你在上一步中创建的超级用户来登录。然后你将会看到 Django 管理页面的索引页</p>
<img alt="Django admin index page" src="../_images/admin02.png" />
<p>你将会看到几种可编辑的内容：组和用户。它们是  <a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal"><span class="pre">django.contrib.auth</span></code></a>  提供的，这是 Django 开发的验证框架。</p>
</div>
<div class="section" id="s-make-the-poll-app-modifiable-in-the-admin">
<span id="make-the-poll-app-modifiable-in-the-admin"></span><h3>向管理页面中加入投票应用<a class="headerlink" href="#make-the-poll-app-modifiable-in-the-admin" title="永久链接至标题">¶</a></h3>
<p>但是我们的投票应用在哪呢？它没在索引页面里显示。</p>
<p>只需要做一件事：我们得告诉管理页面，问题 <code class="docutils literal"><span class="pre">Question</span></code> 对象需要被管理。打开 <code class="file docutils literal"><span class="pre">polls/admin.py</span></code> 文件，把它编辑成下面这样：</p>
<div class="highlight-python"><div class="snippet-filename">polls/admin.py</div>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Question</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Question</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-explore-the-free-admin-functionality">
<span id="explore-the-free-admin-functionality"></span><h3>体验便捷的管理功能<a class="headerlink" href="#explore-the-free-admin-functionality" title="永久链接至标题">¶</a></h3>
<p>现在我们向管理页面注册了问题 <code class="docutils literal"><span class="pre">Question</span></code> 类。Django 知道它应该被显示在索引页里：</p>
<img alt="Django admin index page, now with polls displayed" src="../_images/admin03t.png" />
<p>点击 &#8220;Questions&#8221; 。现在看到是问题 &#8220;Questions&#8221;. 对象的列表 &#8220;change list&#8221; 。这个界面会显示所有数据库里的问题Question对象，你可以选择一个来修改。这里现在有我们在上一部分中创建的“What&#8217;s up?”问题。</p>
<img alt="Polls change list page" src="../_images/admin04t.png" />
<p>点击“What&#8217;s up?”来编辑这个问题（Question）对象：</p>
<img alt="Editing form for question object" src="../_images/admin05t.png" />
<p>有些事情需要注意：</p>
<ul class="simple">
<li><p class="first">这个表单是从问题（Question）模型中自动生成的</p>
</li>
<li><p class="first">不同的字段类型(日期时间字段 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal"><span class="pre">DateTimeField</span></code></a>  、字符字段 <a class="reference internal" href="../ref/models/fields.html#django.db.models.CharField" title="django.db.models.CharField"><code class="xref py py-class docutils literal"><span class="pre">CharField</span></code></a>  )会生成对应的 HTML 输入控件。每个类型的字段都知道它们该如何在管理页面里显示自己。</p>
</li>
<li><p class="first">每个 日期时间字段 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal"><span class="pre">DateTimeField</span></code></a> 都有 JavaScript 写的快捷按钮。日期有转到今天（Today）的快捷按钮和一个弹出式日历界面。时间有设为现在（Now）的快捷按钮和一个列出常用时间的方便的弹出式列表。</p>
</li>
</ul>
<p>页面的底部提供了几个选项：</p>
<ul class="simple">
<li><p class="first">保存（Save） - 保存改变，然后返回对象列表。</p>
</li>
<li><p class="first">保存并继续编辑（Save and continue editing） - 保存改变，然后重新载入当前对象的修改界面。</p>
</li>
<li><p class="first">保存并新增（Save and add another） - 保存改变，然后添加一个新的空对象并载入修改界面。</p>
</li>
<li><p class="first">删除（Delete） - 显示一个确认删除页面。</p>
</li>
</ul>
<p>如果显示的“发布日期（Date Published）”和你在 <a class="reference internal" href="tutorial01.html"><em>教程第一部分</em></a> 里创建它们的时间不一致，这意味着你可能没有正确的设置 <a class="reference internal" href="../ref/settings.html#std:setting-TIME_ZONE"><code class="xref std std-setting docutils literal"><span class="pre">TIME_ZONE</span></code></a> 。改变设置，然后重新载入页面看看是否显示了正确的值。</p>
<p>通过点击“今天”（Today）和“现在（Now）”按钮改变“发布日期（Date Published）”。然后点击“保存并继续编辑（Save and add another）”按钮。然后点击右上角的“历史（History）”按钮。你会看到一个列出了所有通过 Django 管理页面对当前对象进行的改变的页面，其中列出了时间戳和进行修改操作的用户名：</p>
<img alt="History page for question object" src="../_images/admin06t.png" />
<p>当你熟悉了数据库 API 之后，你就可以开始阅读 <a class="reference internal" href="tutorial03.html"><em>教程第三部分</em></a>  ，下一部分我们将会学习如何为投票应用添加更多视图。</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial03.html" class="btn btn-neutral float-right" title="编写你的第一个Django应用，第3部分" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial01.html" class="btn btn-neutral" title="编写你的第一个Django应用，第1部分" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; 版权所有 Django Software Foundation and contributors.
      最后更新于 Apr 27, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.10.dev20160423182652',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>