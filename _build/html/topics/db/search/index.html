

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Search &mdash; Django 1.10.dev20160423182652 文档</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Django 1.10.dev20160423182652 文档" href="../../../"/>
        <link rel="up" title="Models and databases" href="../"/>
        <link rel="next" title="Managers" href="../managers/"/>
        <link rel="prev" title="Aggregation" href="../aggregation/"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../contents/" class="icon icon-home"> Django
          

          
          </a>

          
            
            
              <div class="version">
                1.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../">Django 最新中文文档</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../intro/">开始</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">Using Django</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../install/">How to install Django</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">Models and databases</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../models/">模型</a></li>
<li class="toctree-l3"><a class="reference internal" href="../queries/">Making queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aggregation/">Aggregation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Search</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#use-cases">Use Cases</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../managers/">Managers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sql/">Performing raw SQL queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../transactions/">Database transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multi-db/">Multiple databases</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tablespaces/">Tablespaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../optimization/">Database access optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/">Examples of model relationship API usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../http/">Handling HTTP requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../forms/">Working with forms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../templates/">模板</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class-based-views/">Class-based views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../migrations/">Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../files/">Managing files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/">Testing in Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../auth/">User authentication in Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cache/">Django&#8217;s cache framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../conditional-view-processing/">Conditional View Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../signing/">Cryptographic signing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../email/">Sending email</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../i18n/">国际化和本地化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pagination/">Pagination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python3/">Porting to Python 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/">Security in Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../performance/">性能和优化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../serialization/">Serializing Django objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../settings/">Django settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../signals/">Signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../checks/">System check framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../external-packages/">External packages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../howto/">&#8220;How-to&#8221; guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/">Django FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ref/">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/">元文件和杂记</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../internals/">Django internals</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../contents/">Django</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../contents/">Docs</a> &raquo;</li>
      
          <li><a href="../../">Using Django</a> &raquo;</li>
      
          <li><a href="../">Models and databases</a> &raquo;</li>
      
    <li>Search</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/topics/db/search.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="s-search">
<span id="search"></span><h1>Search<a class="headerlink" href="#search" title="永久链接至标题">¶</a></h1>
<p>A common task for web applications is to search some data in the database with
user input. In a simple case, this could be filtering a list of objects by a
category. A more complex use case might require searching with weighting,
categorization, highlighting, multiple languages, and so on. This document
explains some of the possible use cases and the tools you can use.</p>
<p>We&#8217;ll refer to the same models used in <a class="reference internal" href="../queries/"><em>Making queries</em></a>.</p>
<div class="section" id="s-use-cases">
<span id="use-cases"></span><h2>Use Cases<a class="headerlink" href="#use-cases" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-standard-textual-queries">
<span id="standard-textual-queries"></span><h3>Standard textual queries<a class="headerlink" href="#standard-textual-queries" title="永久链接至标题">¶</a></h3>
<p>Text-based fields have a selection of simple matching operations. For example,
you may wish to allow lookup up an author like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__contains</span><span class="o">=</span><span class="s1">&#39;Terry&#39;</span><span class="p">)</span>
<span class="go">[&lt;Author: Terry Gilliam&gt;, &lt;Author: Terry Jones&gt;]</span>
</pre></div>
</div>
<p>This is a very fragile solution as it requires the user to know an exact
substring of the author&#8217;s name. A better approach could be a case-insensitive
match (<a class="reference internal" href="../../../ref/models/querysets/#std:fieldlookup-icontains"><code class="xref std std-lookup docutils literal"><span class="pre">icontains</span></code></a>), but this is only marginally better.</p>
</div>
<div class="section" id="s-a-database-s-more-advanced-comparison-functions">
<span id="a-database-s-more-advanced-comparison-functions"></span><h3>A database&#8217;s more advanced comparison functions<a class="headerlink" href="#a-database-s-more-advanced-comparison-functions" title="永久链接至标题">¶</a></h3>
<p>If you&#8217;re using PostgreSQL, Django provides <a class="reference internal" href="../../../ref/contrib/postgres/search/"><em>a selection of database
specific tools</em></a> to allow you to leverage more
complex querying options. Other databases have different selections of tools,
possibly via plugins or user-defined functions. Django doesn&#8217;t include any
support for them at this time. We&#8217;ll use some examples from PostgreSQL to
demonstrate the kind of functionality databases may have.</p>
<div class="admonition-searching-in-other-databases admonition">
<p class="first admonition-title">Searching in other databases</p>
<p class="last">All of the searching tools provided by <a class="reference internal" href="../../../ref/contrib/postgres/#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal"><span class="pre">django.contrib.postgres</span></code></a> are
constructed entirely on public APIs such as <a class="reference internal" href="../../../ref/models/lookups/"><em>custom lookups</em></a> and <a class="reference internal" href="../../../ref/models/database-functions/"><em>database functions</em></a>. Depending on your database, you should
be able to construct queries to allow similar APIs. If there are specific
things which cannot be achieved this way, please open a ticket.</p>
</div>
<p>In the above example, we determined that a case insensitive lookup would be
more useful. When dealing with non-English names, a further improvement is to
use <a class="reference internal" href="../../../ref/contrib/postgres/lookups/#std:fieldlookup-unaccent"><code class="xref std std-lookup docutils literal"><span class="pre">unaccented</span> <span class="pre">comparison</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__unaccent__icontains</span><span class="o">=</span><span class="s1">&#39;Helen&#39;</span><span class="p">)</span>
<span class="go">[&lt;Author: Helen Mirren&gt;, &lt;Author: Helena Bonham Carter&gt;, &lt;Actor: Hélène Joy&gt;]</span>
</pre></div>
</div>
<p>This shows another issue, where we are matching against a different spelling of
the name. In this case we have an asymmetry though - a search for <code class="docutils literal"><span class="pre">Helen</span></code>
will pick up <code class="docutils literal"><span class="pre">Helena</span></code> or <code class="docutils literal"><span class="pre">Hélène</span></code>, but not the reverse. Another option
would be to use a trigram comparison, which compares sequences of letters.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__unaccent__lower__trigram</span><span class="o">=</span><span class="s1">&#39;Hélène&#39;</span><span class="p">)</span>
<span class="go">[&lt;Author: Helen Mirren&gt;, &lt;Actor: Hélène Joy&gt;]</span>
</pre></div>
</div>
<p>Now we have a different problem - the longer name of &#8220;Helena Bonham Carter&#8221;
doesn&#8217;t show up as it is much longer. Trigram searches consider all
combinations of three letters, and compares how many appear in both search and
source strings. For the longer name, there are more combinations which appear
in the source string so it is no longer considered a close match.</p>
<p>The correct choice of comparison functions here depends on your particular data
set, for example the language(s) used and the type of text being searched. All
of the examples we&#8217;ve seen are on short strings where the user is likely to
enter something close (by varying definitions) to the source data.</p>
</div>
<div class="section" id="s-document-based-search">
<span id="document-based-search"></span><h3>Document-based search<a class="headerlink" href="#document-based-search" title="永久链接至标题">¶</a></h3>
<p>Simple database operations are too simple an approach when you start
considering large blocks of text. Whereas the examples above can be thought of
as operations on a string of characters, full text search looks at the actual
words. Depending on the system used, it&#8217;s likely to use some of the following
ideas:</p>
<ul class="simple">
<li>Ignoring &#8220;stop words&#8221; such as &#8220;a&#8221;, &#8220;the&#8221;, &#8220;and&#8221;.</li>
<li>Stemming words, so that &#8220;pony&#8221; and &#8220;ponies&#8221; are considered similar.</li>
<li>Weighting words based on different criteria such as how frequently they
appear in the text, or the importance of the fields, such as the title or
keywords, that they appear in.</li>
</ul>
<p>There are many alternatives for using searching software, some of the most
prominent are <a class="reference external" href="https://www.elastic.co/">Elastic</a> and <a class="reference external" href="http://lucene.apache.org/solr/">Solr</a>. These are full document-based search
solutions. To use them with data from Django models, you&#8217;ll need a layer which
translates your data into a textual document, including back-references to the
database ids. When a search using the engine returns a certain document, you
can then look it up in the database. There are a variety of third-party
libraries which are designed to help with this process.</p>
<div class="section" id="s-postgresql-support">
<span id="postgresql-support"></span><h4>PostgreSQL support<a class="headerlink" href="#postgresql-support" title="永久链接至标题">¶</a></h4>
<p>PostgreSQL has its own full text search implementation built-in. While not as
powerful as some other search engines, it has the advantage of being inside
your database and so can easily be combined with other relational queries such
as categorization.</p>
<p>The <a class="reference internal" href="../../../ref/contrib/postgres/#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal"><span class="pre">django.contrib.postgres</span></code></a> module provides some helpers to make these
queries. For example, a simple query might be to select all the blog entries
which mention &#8220;cheese&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">body_text__search</span><span class="o">=</span><span class="s1">&#39;cheese&#39;</span><span class="p">)</span>
<span class="go">[&lt;Entry: Cheese on Toast recipes&gt;, &lt;Entry: Pizza recipes&gt;]</span>
</pre></div>
</div>
<p>You can also filter on a combination of fields and on related models:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">search</span><span class="o">=</span><span class="n">SearchVector</span><span class="p">(</span><span class="s1">&#39;blog__tagline&#39;</span><span class="p">,</span> <span class="s1">&#39;body_text&#39;</span><span class="p">),</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">search</span><span class="o">=</span><span class="s1">&#39;cheese&#39;</span><span class="p">)</span>
<span class="go">[</span>
<span class="go">    &lt;Entry: Cheese on Toast recipes&gt;,</span>
<span class="go">    &lt;Entry: Pizza Recipes&gt;,</span>
<span class="go">    &lt;Entry: Dairy farming in Argentina&gt;,</span>
<span class="go">]</span>
</pre></div>
</div>
<p>See the <code class="docutils literal"><span class="pre">contrib.postgres</span></code> <a class="reference internal" href="../../../ref/contrib/postgres/search/"><em>Full text search</em></a> document for
complete details.</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../managers/" class="btn btn-neutral float-right" title="Managers" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../aggregation/" class="btn btn-neutral" title="Aggregation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; 版权所有 Django Software Foundation and contributors.
      最后更新于 Jul 07, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.10.dev20160423182652',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>